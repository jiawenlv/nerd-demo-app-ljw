{
  "version": "1.0.0",
  "nodes": [
    {
      "id": "e69373be49d88f56d53bd1039b095367",
      "name": "CreateSupplierStart",
      "type": "start",
      "desc": "创建供应商开始",
      "inputs": {
        "supplierCode": {
          "type": "string",
          "desc": "供应商编码",
          "value": "1111"
        },
        "name": {
          "type": "string",
          "desc": "供应商名称",
          "value": "2222"
        },
        "contactName": {
          "type": "string",
          "desc": "联系人姓名",
          "value": "333"
        },
        "phone": {
          "type": "string",
          "desc": "联系电话",
          "value": "444"
        },
        "email": {
          "type": "string",
          "desc": "邮箱",
          "value": "d@gmail.com"
        },
        "address": {
          "type": "string",
          "desc": "地址",
          "value": "666"
        }
      },
      "nextNodes": [
        "ValidateSupplierInput"
      ]
    },
    {
      "id": "87d8af08458586afb2c3665785bfedab",
      "name": "ValidationFailed",
      "type": "end",
      "desc": "验证失败响应",
      "inputs": {
        "checkSupplierExistsExistingSupplier": {
          "type": "array",
          "desc": "已存在的供应商记录",
          "value": ""
        }
      },
      "outputs": {
        "code": {
          "type": "number",
          "desc": "错误状态码",
          "value": "400",
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "data": {
          "type": "object",
          "desc": "错误数据",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "message": {
          "type": "string",
          "desc": "错误信息",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    },
    {
      "id": "85de90574b05e110f59c9d869055089b",
      "name": "CreateSupplierRecord",
      "type": "customSQL",
      "desc": "创建供应商记录",
      "inputs": {
        "code": {
          "type": "string",
          "desc": "供应商编码",
          "value": "$.CreateSupplierStart.inputs.supplierCode"
        },
        "name": {
          "type": "string",
          "desc": "供应商名称",
          "value": "$.CreateSupplierStart.inputs.name"
        },
        "contactName": {
          "type": "string",
          "desc": "联系人姓名",
          "value": "$.CreateSupplierStart.inputs.contactName"
        },
        "phone": {
          "type": "string",
          "desc": "联系电话",
          "value": "$.CreateSupplierStart.inputs.phone"
        },
        "email": {
          "type": "string",
          "desc": "邮箱",
          "value": "$.CreateSupplierStart.inputs.email"
        },
        "address": {
          "type": "string",
          "desc": "地址",
          "value": "$.CreateSupplierStart.inputs.address"
        }
      },
      "outputs": {
        "createSupplierRecordCreatedSupplier": {
          "type": "array",
          "desc": "创建的供应商记录",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "Supplier",
        "sql": "INSERT INTO \"Supplier\" (id, code, name, contactName, phone, email, address, status, \"createdAt\", \"updatedAt\") VALUES (gen_random_uuid(), '${code}', '${name}', '${contactName}', '${phone}', '${email}', '${address}', 'active', NOW(), NOW()) RETURNING id, code, name, contactName, phone, email, address, status, \"createdAt\", \"updatedAt\""
      },
      "nextNodes": [
        "CreateSuccess"
      ]
    },
    {
      "id": "3f38b407053ff03782e1ddb88de8678f",
      "name": "CreateSuccess",
      "type": "end",
      "desc": "创建成功响应",
      "inputs": {
        "createdSupplier": {
          "type": "array",
          "desc": "创建的供应商记录",
          "value": "$.CreateSupplierRecord.outputs.createSupplierRecordCreatedSupplier"
        }
      },
      "outputs": {
        "code": {
          "type": "number",
          "desc": "成功状态码",
          "value": "201",
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "data": {
          "type": "object",
          "desc": "供应商数据",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "message": {
          "type": "string",
          "desc": "成功信息",
          "value": "供应商创建成功",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    },
    {
      "id": "2aca10977f6c68bc70ef625ae700a79d",
      "name": "ValidateSupplierInput",
      "type": "code",
      "desc": "验证供应商输入参数",
      "inputs": {
        "code": {
          "type": "string",
          "desc": "供应商编码",
          "value": "$.CreateSupplierStart.inputs.supplierCode"
        },
        "name": {
          "type": "string",
          "desc": "供应商名称",
          "value": "$.CreateSupplierStart.inputs.name"
        },
        "contactName": {
          "type": "string",
          "desc": "联系人姓名",
          "value": "$.CreateSupplierStart.inputs.contactName"
        },
        "phone": {
          "type": "string",
          "desc": "联系电话",
          "value": "$.CreateSupplierStart.inputs.phone"
        },
        "email": {
          "type": "string",
          "desc": "邮箱",
          "value": "$.CreateSupplierStart.inputs.email"
        }
      },
      "outputs": {
        "validateSupplierInputIsValid": {
          "type": "boolean",
          "desc": "验证是否通过",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        },
        "validateSupplierInputErrorMessage": {
          "type": "string",
          "desc": "错误信息",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        }
      },
      "configs": {
        "dependencies": [],
        "file": {
          "name": "validateSupplierInput.js"
        }
      },
      "nextNodes": [
        "CheckValidationResult"
      ]
    },
    {
      "id": "35b0ec359a6bb00edc08b4a0bdc8fb20",
      "name": "CheckValidationResult",
      "type": "condition",
      "desc": "检查验证结果",
      "inputs": {
        "isValid": {
          "type": "boolean",
          "desc": "验证是否通过",
          "value": "$.ValidateSupplierInput.outputs.validateSupplierInputIsValid"
        }
      },
      "configs": {
        "conditionGroups": [
          {
            "conditions": [
              {
                "left": "${isValid}",
                "operator": "isTrue",
                "right": true
              }
            ],
            "relationship": "AND",
            "handleId": "valid",
            "nextNode": "CheckSupplierExists"
          },
          {
            "conditions": [],
            "relationship": "AND",
            "handleId": "942f44a244d647478791bd57edbf5f8a",
            "isDefaultBranch": true,
            "nextNode": "ValidationFailed"
          }
        ],
        "defaultNextNode": "ValidationFailed"
      }
    },
    {
      "id": "3ee34383c094cb3240ac90fe8c0ab725",
      "name": "CheckSupplierExists",
      "type": "customSQL",
      "desc": "检查供应商是否已存在",
      "inputs": {
        "code": {
          "type": "string",
          "desc": "供应商编码",
          "value": "$.CreateSupplierStart.inputs.supplierCode"
        }
      },
      "outputs": {
        "checkSupplierExistsExistingSupplier": {
          "type": "array",
          "desc": "已存在的供应商记录",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "Supplier",
        "sql": "SELECT id, code, name FROM \"Supplier\" WHERE code = '${code}'"
      },
      "nextNodes": [
        "CheckExistenceResult"
      ]
    },
    {
      "id": "977a0fdbb9ec200a3bac86f8eb34fe21",
      "name": "CheckExistenceResult",
      "type": "code",
      "desc": "检查供应商存在结果",
      "inputs": {
        "existingSupplier": {
          "type": "array",
          "desc": "已存在的供应商记录",
          "value": "$.CheckSupplierExists.outputs.checkSupplierExistsExistingSupplier"
        }
      },
      "outputs": {
        "checkExistenceResultSupplierExists": {
          "type": "boolean",
          "desc": "供应商是否存在",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        }
      },
      "configs": {
        "dependencies": [],
        "file": {
          "name": "checkExistenceResult.js"
        }
      },
      "nextNodes": [
        "CheckSupplierExistenceCondition"
      ]
    },
    {
      "id": "96382cd78ec3c7450be0f3b906288a3b",
      "name": "CheckSupplierExistenceCondition",
      "type": "condition",
      "desc": "检查供应商存在条件",
      "inputs": {
        "supplierExists": {
          "type": "boolean",
          "desc": "供应商是否存在",
          "value": "$.CheckExistenceResult.outputs.checkExistenceResultSupplierExists"
        }
      },
      "configs": {
        "conditionGroups": [
          {
            "conditions": [
              {
                "left": "${supplierExists}",
                "operator": "isTrue",
                "right": true
              }
            ],
            "relationship": "AND",
            "handleId": "exists",
            "nextNode": "SupplierExistsError"
          },
          {
            "conditions": [],
            "relationship": "AND",
            "handleId": "dd686573536448c5b3c03b2567cd7a1d",
            "isDefaultBranch": true,
            "nextNode": "CreateSupplierRecord"
          }
        ],
        "defaultNextNode": "CreateSupplierRecord"
      }
    },
    {
      "id": "eef8a23e9a42ef428b21d1980db5781b",
      "name": "SupplierExistsError",
      "type": "end",
      "desc": "供应商已存在错误响应",
      "inputs": {
        "createSupplierRecordCreatedSupplier": {
          "type": "array",
          "desc": "创建的供应商记录",
          "value": ""
        }
      },
      "outputs": {
        "code": {
          "type": "number",
          "desc": "冲突状态码",
          "value": "409",
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "data": {
          "type": "object",
          "desc": "错误数据",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "message": {
          "type": "string",
          "desc": "错误信息",
          "value": "供应商编码已存在",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    }
  ]
}