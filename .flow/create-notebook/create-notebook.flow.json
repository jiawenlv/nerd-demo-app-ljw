{
  "version": "1.0.0",
  "nodes": [
    {
      "id": "6f111773fc105b66be10f9840f2e3e99",
      "name": "Start",
      "type": "start",
      "desc": "工作流开始节点，接收用户ID和笔记本名称",
      "inputs": {
        "StartUserId": {
          "type": "string",
          "desc": "用户ID",
          "value": "1"
        },
        "StartNotebookName": {
          "type": "string",
          "desc": "笔记本名称",
          "value": "吕嘉文的notebook3"
        }
      },
      "nextNodes": [
        "ValidateUserExists"
      ]
    },
    {
      "id": "21ff29aaf95b5cb18f6c8bd5d5498c59",
      "name": "ValidateUserExists",
      "type": "customSQL",
      "desc": "验证用户是否存在",
      "inputs": {
        "ValidateUserExistsUserId": {
          "type": "string",
          "desc": "要验证的用户ID",
          "value": "$.Start.inputs.StartUserId"
        }
      },
      "outputs": {
        "ValidateUserExistsUserData": {
          "type": "array",
          "desc": "用户查询结果",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "user",
        "sql": "SELECT \"id\" FROM \"user\" WHERE \"id\" = '${ValidateUserExistsUserId}'"
      },
      "nextNodes": [
        "CheckUserExistence"
      ]
    },
    {
      "id": "dcdb1ca14ce9a4c8667842903557fb65",
      "name": "CheckUserExistence",
      "type": "condition",
      "desc": "检查用户是否存在",
      "inputs": {
        "CheckUserExistenceUserData": {
          "type": "array",
          "desc": "用户查询结果数据",
          "value": "$.ValidateUserExists.outputs.ValidateUserExistsUserData"
        }
      },
      "configs": {
        "conditionGroups": [
          {
            "conditions": [
              {
                "left": "${CheckUserExistenceUserData}",
                "operator": "isNull",
                "right": ""
              }
            ],
            "relationship": "OR",
            "handleId": "b76cd6f1051848dd9f2d1c8a3866edea",
            "nextNode": "UserNotFoundEnd"
          },
          {
            "conditions": [
              {
                "left": "${CheckUserExistenceUserData}",
                "operator": "notEqual",
                "right": ""
              }
            ],
            "relationship": "OR",
            "handleId": "b06f4d4480914383b8d89f43f4df6453",
            "nextNode": "CheckNotebookNameDuplicate"
          },
          {
            "conditions": [],
            "relationship": "AND",
            "handleId": "73ffddaffb7d4de184b3a42d1a61ea33",
            "isDefaultBranch": true
          }
        ]
      }
    },
    {
      "id": "ace5a49df0e5cdfa30878981b937d3b9",
      "name": "UserNotFoundEnd",
      "type": "end",
      "desc": "用户不存在时的结束节点",
      "outputs": {
        "UserNotFoundEndCode": {
          "type": "number",
          "desc": "错误码",
          "value": 404,
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "UserNotFoundEndMessage": {
          "type": "string",
          "desc": "错误信息",
          "value": "用户不存在",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "UserNotFoundEndData": {
          "type": "object",
          "desc": "空数据",
          "value": {},
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    },
    {
      "id": "a1b2c3d4e5f67890abcd1234ef567890",
      "name": "CheckNotebookNameDuplicate",
      "type": "customSQL",
      "desc": "检查笔记本名称是否重复",
      "inputs": {
        "CheckNotebookNameDuplicateUserId": {
          "type": "string",
          "desc": "用户ID",
          "value": "$.Start.inputs.StartUserId"
        },
        "CheckNotebookNameDuplicateNotebookName": {
          "type": "string",
          "desc": "笔记本名称",
          "value": "$.Start.inputs.StartNotebookName"
        }
      },
      "outputs": {
        "CheckNotebookNameDuplicateNotebookData": {
          "type": "array",
          "desc": "笔记本查询结果",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "notebooks",
        "sql": "SELECT \"notebook_id\" FROM \"notebooks\" WHERE \"user_id\" = '${CheckNotebookNameDuplicateUserId}' AND \"name\" = '${CheckNotebookNameDuplicateNotebookName}'"
      },
      "nextNodes": [
        "CheckNotebookDuplicateCondition"
      ]
    },
    {
      "id": "b2c3d4e5f67890abcd1234ef56789012",
      "name": "CheckNotebookDuplicateCondition",
      "type": "condition",
      "desc": "检查笔记本名称是否重复的条件判断",
      "inputs": {
        "CheckNotebookDuplicateConditionNotebookData": {
          "type": "array",
          "desc": "笔记本查询结果数据",
          "value": "$.CheckNotebookNameDuplicate.outputs.CheckNotebookNameDuplicateNotebookData"
        }
      },
      "configs": {
        "conditionGroups": [
          {
            "conditions": [
              {
                "left": "${CheckNotebookDuplicateConditionNotebookData.length}",
                "operator": "greaterThan",
                "right": 0
              }
            ],
            "relationship": "OR",
            "handleId": "c76cd6f1051848dd9f2d1c8a3866edeb",
            "nextNode": "NotebookDuplicateEnd"
          },
          {
            "conditions": [
              {
                "left": "${CheckNotebookDuplicateConditionNotebookData}",
                "operator": "isNull",
                "right": ""
              }
            ],
            "relationship": "OR",
            "handleId": "d06f4d4480914383b8d89f43f4df6454",
            "nextNode": "CreateNotebookRecord"
          },
          {
            "conditions": [],
            "relationship": "AND",
            "handleId": "83ffddaffb7d4de184b3a42d1a61ea34",
            "isDefaultBranch": true
          }
        ]
      }
    },
    {
      "id": "c3d4e5f67890abcd1234ef5678901234",
      "name": "NotebookDuplicateEnd",
      "type": "end",
      "desc": "笔记本名称重复时的结束节点",
      "outputs": {
        "NotebookDuplicateEndCode": {
          "type": "number",
          "desc": "错误码",
          "value": 409,
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "NotebookDuplicateEndMessage": {
          "type": "string",
          "desc": "错误信息",
          "value": "笔记本名称已存在",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "NotebookDuplicateEndData": {
          "type": "object",
          "desc": "空数据",
          "value": {},
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    },
    {
      "id": "51daec67e7750308744224f277a438d4",
      "name": "CreateNotebookRecord",
      "type": "customSQL",
      "desc": "创建笔记本记录",
      "inputs": {
        "CreateNotebookRecordUserId": {
          "type": "string",
          "desc": "用户ID",
          "value": "$.Start.inputs.StartUserId"
        },
        "CreateNotebookRecordName": {
          "type": "string",
          "desc": "笔记本名称",
          "value": "$.Start.inputs.StartNotebookName"
        }
      },
      "outputs": {
        "CreateNotebookRecordNotebookId": {
          "type": "array",
          "desc": "创建的笔记本ID",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "notebooks",
        "sql": "INSERT INTO \"notebooks\" (\"user_id\", \"name\", \"created_at\", \"updated_at\") VALUES ('${CreateNotebookRecordUserId}', '${CreateNotebookRecordName}', NOW(), NOW()) RETURNING \"notebook_id\""
      },
      "nextNodes": [
        "SuccessEnd"
      ]
    },
    {
      "id": "1b62656dd2392a9fa93eca7d640f83c1",
      "name": "SuccessEnd",
      "type": "end",
      "desc": "成功创建笔记本的结束节点",
      "inputs": {
        "SuccessEndNotebookId": {
          "type": "array",
          "desc": "创建的笔记本ID",
          "value": "$.CreateNotebookRecord.outputs.CreateNotebookRecordNotebookId"
        }
      },
      "outputs": {
        "SuccessEndCode": {
          "type": "number",
          "desc": "成功码",
          "value": 200,
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "SuccessEndMessage": {
          "type": "string",
          "desc": "成功信息",
          "value": "笔记本创建成功",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "SuccessEndData": {
          "type": "object",
          "desc": "创建的笔记本数据",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    }
  ]
}