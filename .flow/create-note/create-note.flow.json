{
  "version": "1.0.0",
  "nodes": [
    {
      "id": "7eb3ea4a568591831c06170f4bec6926",
      "name": "Start",
      "type": "start",
      "desc": "开始节点，接收用户ID和笔记本ID作为输入",
      "inputs": {
        "UserId": {
          "type": "string",
          "desc": "用户ID",
          "value": "1"
        },
        "NotebookId": {
          "type": "string",
          "desc": "笔记本ID",
          "value": "5"
        },
        "NoteTitle": {
          "type": "string",
          "desc": "笔记标题",
          "value": "lv"
        },
        "NoteContent": {
          "type": "string",
          "desc": "笔记内容",
          "value": "jiawen"
        }
      },
      "nextNodes": [
        "ValidateUserExists"
      ]
    },
    {
      "id": "7e3c473bb10f0b8b69a17e3f85d6b851",
      "name": "ValidateUserExists",
      "type": "customSQL",
      "desc": "验证用户是否存在",
      "inputs": {
        "ValidateUserExistsUserId": {
          "type": "string",
          "desc": "用户ID",
          "value": "$.Start.inputs.UserId"
        }
      },
      "outputs": {
        "UserData": {
          "type": "array",
          "desc": "用户数据",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "user",
        "sql": "SELECT \"id\", \"name\" FROM \"user\" WHERE \"id\" = '${ValidateUserExistsUserId}'"
      },
      "nextNodes": [
        "CheckUserCondition"
      ]
    },
    {
      "id": "12f4b7f184f6584810bececb13ffb78d",
      "name": "CheckUserCondition",
      "type": "condition",
      "desc": "检查用户是否存在条件判断",
      "inputs": {
        "CheckUserConditionUserData": {
          "type": "array",
          "desc": "用户数据",
          "value": "$.ValidateUserExists.outputs.UserData"
        }
      },
      "configs": {
        "conditionGroups": [
          {
            "conditions": [
              {
                "left": "${CheckUserConditionUserData}",
                "operator": "isNull",
                "right": ""
              }
            ],
            "relationship": "OR",
            "handleId": "1870073c244340afaf7d94eed75f43ab",
            "nextNode": "UserNotFoundEnd"
          },
          {
            "conditions": [
              {
                "left": "${CheckUserConditionUserData}",
                "operator": "isNotNull",
                "right": ""
              }
            ],
            "relationship": "AND",
            "handleId": "f8a73975b9ea4965b26df2c34c6f44e9",
            "nextNode": "ValidateNotebookExists"
          },
          {
            "conditions": [],
            "relationship": "AND",
            "handleId": "b15c24c270e842f2907d27df8d46ce5d",
            "isDefaultBranch": true
          }
        ]
      }
    },
    {
      "id": "056730c8ee31970996339c16615607de",
      "name": "UserNotFoundEnd",
      "type": "end",
      "desc": "用户不存在结束节点",
      "outputs": {
        "UserNotFoundEndCode": {
          "type": "number",
          "desc": "状态码",
          "value": 404,
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "UserNotFoundEndMessage": {
          "type": "string",
          "desc": "错误消息",
          "value": "用户不存在",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "UserNotFoundEndData": {
          "type": "object",
          "desc": "返回数据",
          "value": {},
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    },
    {
      "id": "1a637593785ba63dd1c7f7fde1803fd9",
      "name": "ValidateNotebookExists",
      "type": "customSQL",
      "desc": "验证笔记本是否存在",
      "inputs": {
        "ValidateNotebookExistsNotebookId": {
          "type": "number",
          "desc": "笔记本ID",
          "value": "$.Start.inputs.NotebookId"
        },
        "ValidateNotebookExistsUserId": {
          "type": "string",
          "desc": "用户ID",
          "value": "$.Start.inputs.UserId"
        }
      },
      "outputs": {
        "NotebookData": {
          "type": "array",
          "desc": "笔记本数据",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "notebooks",
        "sql": "SELECT \"notebook_id\", \"user_id\" FROM \"notebooks\" WHERE \"notebook_id\" = ${ValidateNotebookExistsNotebookId} AND \"user_id\" = '${ValidateNotebookExistsUserId}'"
      },
      "nextNodes": [
        "CheckNotebookCondition"
      ]
    },
    {
      "id": "75e28108dff00132631784d91141e65d",
      "name": "CheckNotebookCondition",
      "type": "condition",
      "desc": "检查笔记本是否存在条件判断",
      "inputs": {
        "CheckNotebookConditionNotebookData": {
          "type": "array",
          "desc": "笔记本数据",
          "value": "$.ValidateNotebookExists.outputs.NotebookData"
        }
      },
      "configs": {
        "conditionGroups": [
          {
            "conditions": [
              {
                "left": "${CheckNotebookConditionNotebookData}",
                "operator": "isNull",
                "right": ""
              }
            ],
            "relationship": "OR",
            "handleId": "3262591d784345e18c66942398fee50c",
            "nextNode": "NotebookNotFoundEnd"
          },
          {
            "conditions": [
              {
                "left": "${CheckNotebookConditionNotebookData}",
                "operator": "isNotNull",
                "right": ""
              }
            ],
            "relationship": "AND",
            "handleId": "92475849e3264325a1a198ae52c61aa8",
            "nextNode": "GenerateNoteData"
          },
          {
            "conditions": [],
            "relationship": "AND",
            "handleId": "02bf138b10cd47fd894a11051c9235ef",
            "isDefaultBranch": true
          }
        ]
      }
    },
    {
      "id": "ae7853128abdc5863d5272f5f68ec4d0",
      "name": "NotebookNotFoundEnd",
      "type": "end",
      "desc": "笔记本不存在结束节点",
      "outputs": {
        "NotebookNotFoundEndCode": {
          "type": "number",
          "desc": "状态码",
          "value": 404,
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "NotebookNotFoundEndMessage": {
          "type": "string",
          "desc": "错误消息",
          "value": "笔记本不存在",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "NotebookNotFoundEndData": {
          "type": "object",
          "desc": "返回数据",
          "value": {},
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    },
    {
      "id": "43c78b1bf95af2e9037276ef400b92a6",
      "name": "GenerateNoteData",
      "type": "code",
      "desc": "生成笔记数据",
      "inputs": {
        "GenerateNoteDataUserId": {
          "type": "string",
          "desc": "用户ID",
          "value": "$.Start.inputs.UserId"
        },
        "GenerateNoteDataNotebookId": {
          "type": "number",
          "desc": "笔记本ID",
          "value": "$.Start.inputs.NotebookId"
        },
        "GenerateNoteDataNoteTitle": {
          "type": "string",
          "desc": "笔记标题",
          "value": "$.Start.inputs.NoteTitle"
        },
        "GenerateNoteDataNoteContent": {
          "type": "string",
          "desc": "笔记内容",
          "value": "$.Start.inputs.NoteContent"
        }
      },
      "outputs": {
        "NoteData": {
          "type": "object",
          "desc": "笔记数据",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        }
      },
      "configs": {
        "file": {
          "name": "generateNoteData.js"
        },
        "dependencies": []
      },
      "nextNodes": [
        "CreateNoteRecord"
      ]
    },
    {
      "id": "619e345c0ea18b68e7321c081824ad1c",
      "name": "CreateNoteRecord",
      "type": "customSQL",
      "desc": "创建笔记记录",
      "inputs": {
        "CreateNoteRecordNoteData": {
          "type": "object",
          "desc": "笔记数据对象",
          "value": "$.GenerateNoteData.outputs.NoteData"
        }
      },
      "outputs": {
        "NoteId": {
          "type": "array",
          "desc": "笔记ID",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "notes",
        "sql": "INSERT INTO \"notes\" (\"user_id\", \"notebook_id\", \"title\", \"content\", \"content_format\", \"is_pinned\", \"is_archived\", \"is_trashed\", \"tags\", \"created_at\", \"updated_at\") VALUES ('${CreateNoteRecordNoteData.user_id}', ${CreateNoteRecordNoteData.notebook_id}, '${CreateNoteRecordNoteData.title}', '${CreateNoteRecordNoteData.content}', '${CreateNoteRecordNoteData.content_format}', ${CreateNoteRecordNoteData.is_pinned}, ${CreateNoteRecordNoteData.is_archived}, ${CreateNoteRecordNoteData.is_trashed}, '${CreateNoteRecordNoteData.tags}', '${CreateNoteRecordNoteData.created_at}', '${CreateNoteRecordNoteData.updated_at}') RETURNING \"note_id\""
      },
      "nextNodes": [
        "End"
      ]
    },
    {
      "id": "8b84fce04b00239224ed0e14ee5d9ea7",
      "name": "End",
      "type": "end",
      "desc": "成功结束节点",
      "inputs": {
        "NoteId": {
          "type": "array",
          "desc": "笔记ID",
          "value": "$.CreateNoteRecord.outputs.NoteId"
        }
      },
      "outputs": {
        "EndCode": {
          "type": "number",
          "desc": "状态码",
          "value": 200,
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "EndMessage": {
          "type": "string",
          "desc": "成功消息",
          "value": "笔记创建成功",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "EndData": {
          "type": "object",
          "desc": "返回数据",
          "value": {
            "noteId": "$.CreateNoteRecord.outputs.NoteId[0].note_id"
          },
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    }
  ]
}