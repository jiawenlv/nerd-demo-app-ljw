{
  "version": "1.0.0",
  "nodes": [
    {
      "id": "3c4ec5fdfb375825b5903586a56210ae",
      "name": "Start",
      "type": "start",
      "desc": "标签创建工作流开始节点，接收标签创建参数",
      "inputs": {
        "TagName": {
          "type": "string",
          "desc": "标签名称",
          "value": "1"
        },
        "TagType": {
          "type": "string",
          "desc": "标签类型",
          "value": ""
        },
        "CreatedBy": {
          "type": "string",
          "desc": "创建者ID",
          "value": ""
        }
      },
      "nextNodes": [
        "ValidateInput"
      ]
    },
    {
      "id": "a669053744a2a927db636625c389a06f",
      "name": "ValidateInput",
      "type": "code",
      "desc": "验证输入参数的有效性",
      "inputs": {
        "TagName": {
          "type": "string",
          "desc": "标签名称",
          "value": "$.Start.inputs.TagName"
        },
        "TagType": {
          "type": "string",
          "desc": "标签类型",
          "value": "$.Start.inputs.TagType"
        },
        "CreatedBy": {
          "type": "string",
          "desc": "创建者ID",
          "value": "$.Start.inputs.CreatedBy"
        }
      },
      "outputs": {
        "ValidatedTagName": {
          "type": "string",
          "desc": "验证后的标签名称",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        },
        "ValidatedTagType": {
          "type": "string",
          "desc": "验证后的标签类型",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        },
        "ValidatedCreatedBy": {
          "type": "string",
          "desc": "验证后的创建者ID",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        }
      },
      "configs": {
        "file": {
          "name": "validateInput.js"
        },
        "dependencies": []
      },
      "nextNodes": [
        "CheckTagExists"
      ]
    },
    {
      "id": "6efffdb6a0fc9858d2d522ea3a5224a2",
      "name": "CheckTagExists",
      "type": "customSQL",
      "desc": "检查标签是否已存在",
      "inputs": {
        "ValidatedTagName": {
          "type": "string",
          "desc": "验证后的标签名称",
          "value": "$.ValidateInput.outputs.ValidatedTagName"
        },
        "ValidatedTagType": {
          "type": "string",
          "desc": "验证后的标签类型",
          "value": "$.ValidateInput.outputs.ValidatedTagType"
        }
      },
      "outputs": {
        "TagExistsData": {
          "type": "array",
          "desc": "标签存在性检查结果",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "employee",
        "sql": "SELECT \"id\", \"name\", \"type\" FROM \"employee\" WHERE \"name\" = '${ValidatedTagName}' AND \"type\" = '${ValidatedTagType}' LIMIT 1"
      },
      "nextNodes": [
        "TagExistsCondition"
      ]
    },
    {
      "id": "660342150e76ac43ae938cff888809ca",
      "name": "TagExistsCondition",
      "type": "condition",
      "desc": "判断标签是否已存在的条件分支",
      "inputs": {
        "TagExistsData": {
          "type": "array",
          "desc": "标签存在性检查结果",
          "value": "$.CheckTagExists.outputs.TagExistsData"
        }
      },
      "configs": {
        "conditionGroups": [
          {
            "conditions": [
              {
                "left": "${TagExistsData}",
                "operator": "isNotNull",
                "right": ""
              }
            ],
            "relationship": "AND",
            "handleId": "26411627eb064df79bc9d78731122a3e",
            "nextNode": "TagAlreadyExists"
          },
          {
            "conditions": [
              {
                "left": "${TagExistsData}",
                "operator": "isNull",
                "right": ""
              }
            ],
            "relationship": "AND",
            "handleId": "d635e3e1ca3c41c09cefaff6a8db52e5",
            "isDefaultBranch": true,
            "nextNode": "CreateTagRecord"
          }
        ],
        "defaultNextNode": "CreateTagRecord"
      }
    },
    {
      "id": "ecad1f8c7913f7e169ef5f42396a5edd",
      "name": "CreateTagRecord",
      "type": "customSQL",
      "desc": "创建新的标签记录",
      "inputs": {
        "ValidatedTagName": {
          "type": "string",
          "desc": "验证后的标签名称",
          "value": "$.ValidateInput.outputs.ValidatedTagName"
        },
        "ValidatedTagType": {
          "type": "string",
          "desc": "验证后的标签类型",
          "value": "$.ValidateInput.outputs.ValidatedTagType"
        },
        "ValidatedCreatedBy": {
          "type": "string",
          "desc": "验证后的创建者ID",
          "value": "$.ValidateInput.outputs.ValidatedCreatedBy"
        }
      },
      "outputs": {
        "CreatedTagData": {
          "type": "object",
          "desc": "创建的标签数据",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "employee",
        "sql": "INSERT INTO \"employee\" (\"name\", \"type\", \"created_at\", \"updated_at\") VALUES ('${ValidatedTagName}', '${ValidatedTagType}', NOW(), NOW()) RETURNING \"id\""
      },
      "nextNodes": [
        "TagCreationSuccess"
      ]
    },
    {
      "id": "18edb306fb887084cedc6e3442971be8",
      "name": "TagAlreadyExists",
      "type": "end",
      "desc": "标签已存在结束节点",
      "inputs": {
        "CreatedTagData": {
          "type": "object",
          "desc": "创建的标签数据",
          "value": ""
        }
      },
      "outputs": {
        "Code": {
          "type": "number",
          "desc": "响应状态码",
          "value": 409,
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "Message": {
          "type": "string",
          "desc": "错误消息",
          "value": "标签已存在",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "Data": {
          "type": "object",
          "desc": "已存在的标签数据",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    },
    {
      "id": "f948156f2491d932e7b8fb73c77b04b6",
      "name": "TagCreationSuccess",
      "type": "end",
      "desc": "标签创建成功结束节点",
      "inputs": {
        "Code": {
          "type": "number",
          "desc": "响应状态码",
          "value": ""
        },
        "Message": {
          "type": "string",
          "desc": "错误消息",
          "value": ""
        },
        "Data": {
          "type": "object",
          "desc": "已存在的标签数据",
          "value": ""
        }
      },
      "outputs": {
        "Code": {
          "type": "number",
          "desc": "响应状态码",
          "value": 200,
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "Message": {
          "type": "string",
          "desc": "成功消息",
          "value": "标签创建成功",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "Data": {
          "type": "object",
          "desc": "创建成功的标签数据",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    }
  ]
}