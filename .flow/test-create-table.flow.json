{
  "version": "1.0.0",
  "nodes": [
    {
      "id": "01b8ec2fce69aaf45cbe39ea78bfeab5",
      "name": "Start",
      "type": "start",
      "desc": "开始节点，接收仓库创建参数",
      "inputs": {
        "WarehouseName": {
          "type": "string",
          "desc": "仓库名称",
          "value": ""
        },
        "WarehouseCode": {
          "type": "string",
          "desc": "仓库编码",
          "value": ""
        },
        "WarehouseAddress": {
          "type": "string",
          "desc": "仓库地址",
          "value": ""
        },
        "ContactPerson": {
          "type": "string",
          "desc": "联系人",
          "value": ""
        },
        "ContactPhone": {
          "type": "string",
          "desc": "联系电话",
          "value": ""
        },
        "Capacity": {
          "type": "number",
          "desc": "仓库容量",
          "value": ""
        },
        "Status": {
          "type": "string",
          "desc": "仓库状态",
          "value": ""
        }
      },
      "nextNodes": [
        "ValidateInput"
      ]
    },
    {
      "id": "c08d7acd75a45445406f6b33130ed0ea",
      "name": "ValidateInput",
      "type": "code",
      "desc": "验证输入参数的有效性",
      "inputs": {
        "WarehouseName": {
          "type": "string",
          "desc": "仓库名称",
          "value": "$.Start.inputs.WarehouseName"
        },
        "WarehouseCode": {
          "type": "string",
          "desc": "仓库编码",
          "value": "$.Start.inputs.WarehouseCode"
        },
        "WarehouseAddress": {
          "type": "string",
          "desc": "仓库地址",
          "value": "$.Start.inputs.WarehouseAddress"
        },
        "ContactPerson": {
          "type": "string",
          "desc": "联系人",
          "value": "$.Start.inputs.ContactPerson"
        },
        "ContactPhone": {
          "type": "string",
          "desc": "联系电话",
          "value": "$.Start.inputs.ContactPhone"
        },
        "Capacity": {
          "type": "number",
          "desc": "仓库容量",
          "value": "$.Start.inputs.Capacity"
        },
        "Status": {
          "type": "string",
          "desc": "仓库状态",
          "value": "$.Start.inputs.Status"
        }
      },
      "outputs": {
        "ValidatedWarehouseName": {
          "type": "string",
          "desc": "验证后的仓库名称",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        },
        "ValidatedWarehouseCode": {
          "type": "string",
          "desc": "验证后的仓库编码",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        },
        "ValidatedWarehouseAddress": {
          "type": "string",
          "desc": "验证后的仓库地址",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        },
        "ValidatedContactPerson": {
          "type": "string",
          "desc": "验证后的联系人",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        },
        "ValidatedContactPhone": {
          "type": "string",
          "desc": "验证后的联系电话",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        },
        "ValidatedCapacity": {
          "type": "number",
          "desc": "验证后的仓库容量",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        },
        "ValidatedStatus": {
          "type": "string",
          "desc": "验证后的仓库状态",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        }
      },
      "configs": {
        "file": {
          "name": "validateInput.js"
        },
        "dependencies": []
      },
      "nextNodes": [
        "CheckWarehouseCodeExists"
      ]
    },
    {
      "id": "cedfe68574aa712e622c2854a9401703",
      "name": "CheckWarehouseCodeExists",
      "type": "customSQL",
      "desc": "检查仓库编码是否已存在",
      "inputs": {
        "WarehouseCode": {
          "type": "string",
          "desc": "仓库编码",
          "value": "$.ValidateInput.outputs.ValidatedWarehouseCode"
        }
      },
      "outputs": {
        "CheckResult": {
          "type": "object",
          "desc": "检查结果",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "warehouse",
        "sql": "SELECT COUNT(*) as count FROM \"warehouse\" WHERE \"code\" = '${WarehouseCode}'"
      },
      "nextNodes": [
        "ParseCheckResult"
      ]
    },
    {
      "id": "61f12f9329541be344ab0c935eb665ad",
      "name": "ParseCheckResult",
      "type": "code",
      "desc": "解析检查结果",
      "inputs": {
        "CheckResult": {
          "type": "object",
          "desc": "检查结果",
          "value": "$.CheckWarehouseCodeExists.outputs.CheckResult"
        }
      },
      "outputs": {
        "CodeExists": {
          "type": "boolean",
          "desc": "编码是否存在",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        }
      },
      "configs": {
        "file": {
          "name": "parseCheckResult.js"
        },
        "dependencies": []
      },
      "nextNodes": [
        "CheckCodeCondition"
      ]
    },
    {
      "id": "675dca71852868eba3f154c6544ae6e5",
      "name": "CheckCodeCondition",
      "type": "condition",
      "desc": "检查编码是否存在条件分支",
      "inputs": {
        "CodeExists": {
          "type": "boolean",
          "desc": "编码是否存在",
          "value": "$.ParseCheckResult.outputs.CodeExists"
        }
      },
      "configs": {
        "conditionGroups": [
          {
            "conditions": [
              {
                "left": "${CodeExists}",
                "operator": "isTrue",
                "right": true
              }
            ],
            "relationship": "AND",
            "handleId": "4a382d4b9e1a4421b50f731663cad8d6",
            "nextNode": "EndCodeExists"
          },
          {
            "conditions": [
              {
                "left": "${CodeExists}",
                "operator": "isFalse",
                "right": true
              }
            ],
            "relationship": "AND",
            "handleId": "dca04dc3ec294e049f8d1f56c71e95bd",
            "nextNode": "CreateWarehouseRecord"
          },
          {
            "conditions": [],
            "relationship": "AND",
            "handleId": "c64f44c59ca948c482d3a99a918bad36",
            "isDefaultBranch": true
          }
        ]
      }
    },
    {
      "id": "e3ee42bd9a9652ca549ed77da4074a23",
      "name": "CreateWarehouseRecord",
      "type": "customSQL",
      "desc": "创建仓库记录",
      "inputs": {
        "WarehouseName": {
          "type": "string",
          "desc": "仓库名称",
          "value": "$.ValidateInput.outputs.ValidatedWarehouseName"
        },
        "WarehouseCode": {
          "type": "string",
          "desc": "仓库编码",
          "value": "$.ValidateInput.outputs.ValidatedWarehouseCode"
        },
        "WarehouseAddress": {
          "type": "string",
          "desc": "仓库地址",
          "value": "$.ValidateInput.outputs.ValidatedWarehouseAddress"
        },
        "ContactPerson": {
          "type": "string",
          "desc": "联系人",
          "value": "$.ValidateInput.outputs.ValidatedContactPerson"
        },
        "ContactPhone": {
          "type": "string",
          "desc": "联系电话",
          "value": "$.ValidateInput.outputs.ValidatedContactPhone"
        },
        "Capacity": {
          "type": "number",
          "desc": "仓库容量",
          "value": "$.ValidateInput.outputs.ValidatedCapacity"
        },
        "Status": {
          "type": "string",
          "desc": "仓库状态",
          "value": "$.ValidateInput.outputs.ValidatedStatus"
        }
      },
      "outputs": {
        "CreatedWarehouse": {
          "type": "object",
          "desc": "创建的仓库记录",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      },
      "configs": {
        "table": "warehouse",
        "sql": "INSERT INTO \"warehouse\" (\"name\", \"code\", \"address\", \"contact_person\", \"contact_phone\", \"capacity\", \"status\", \"created_at\", \"updated_at\") VALUES ('${WarehouseName}', '${WarehouseCode}', '${WarehouseAddress}', '${ContactPerson}', '${ContactPhone}', ${Capacity}, '${Status}', NOW(), NOW()) RETURNING \"id\", \"name\", \"code\", \"address\", \"contact_person\", \"contact_phone\", \"capacity\", \"status\", \"created_at\", \"updated_at\""
      },
      "nextNodes": [
        "ParseCreateResult"
      ]
    },
    {
      "id": "52218f461a86349fd2adc394da68fc33",
      "name": "EndCodeExists",
      "type": "end",
      "desc": "编码已存在结束节点",
      "inputs": {
        "CreatedWarehouse": {
          "type": "object",
          "desc": "创建的仓库记录",
          "value": ""
        }
      },
      "outputs": {
        "code": {
          "type": "number",
          "desc": "响应状态码",
          "value": 400,
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "data": {
          "type": "object",
          "desc": "响应数据",
          "value": {},
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "message": {
          "type": "string",
          "desc": "响应消息",
          "value": "仓库编码已存在",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    },
    {
      "id": "38e176099d986e943fb37b3cff6bed33",
      "name": "ParseCreateResult",
      "type": "code",
      "desc": "解析创建结果",
      "inputs": {
        "CreatedWarehouse": {
          "type": "object",
          "desc": "创建的仓库记录",
          "value": "$.CreateWarehouseRecord.outputs.CreatedWarehouse"
        }
      },
      "outputs": {
        "WarehouseData": {
          "type": "object",
          "desc": "解析后的仓库数据",
          "isDynamic": false,
          "isBuiltin": false,
          "editable": true,
          "removable": true
        }
      },
      "configs": {
        "file": {
          "name": "parseCreateResult.js"
        },
        "dependencies": []
      },
      "nextNodes": [
        "EndSuccess"
      ]
    },
    {
      "id": "67b06d052811e4478342663e7fd74699",
      "name": "EndSuccess",
      "type": "end",
      "desc": "成功结束节点",
      "inputs": {
        "WarehouseData": {
          "type": "object",
          "desc": "解析后的仓库数据",
          "value": "$.ParseCreateResult.outputs.WarehouseData"
        }
      },
      "outputs": {
        "code": {
          "type": "number",
          "desc": "响应状态码",
          "value": 200,
          "builtinAttrName": "code",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "data": {
          "type": "object",
          "desc": "响应数据",
          "builtinAttrName": "data",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        },
        "message": {
          "type": "string",
          "desc": "响应消息",
          "value": "仓库创建成功",
          "builtinAttrName": "message",
          "isDynamic": true,
          "isBuiltin": true,
          "editable": true,
          "removable": false
        }
      }
    }
  ]
}